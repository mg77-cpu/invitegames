generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model User {
  id            String         @id // Matches Clerk User ID
  email         String         @unique
  name          String?
  payments      Payment[]
  subscriptions Subscription[]
  createdAt     DateTime       @default(now())
}

model Payment {
  id             String   @id @default(cuid())
  amount         Int
  status         String // e.g., 'succeeded', 'pending'
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  parentName     String?
  athleteName    String?
  ageTier        String?
  stripeEventId  String?  @unique
  createdAt      DateTime @default(now())
}

model Subscription {
  id                   String   @id @default(cuid())
  userId               String
  user                 User     @relation(fields: [userId], references: [id])
  planName             String
  status               String   @default("active") // active, expired
  startDate            DateTime @default(now())
  endDate              DateTime
  parentName           String?
  athleteName          String?
  ageTier              String?
  stripeSubscriptionId String?
  stripeSessionId      String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([userId])
  @@unique([userId, athleteName, ageTier], name: "subscription_identifier")
}
